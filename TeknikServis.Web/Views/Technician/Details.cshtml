@using TeknikServis.BLL.Identity;
@model TeknikServis.Models.ViewModels.IssueVM
@{
    ViewBag.Title = "Issue Details";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<div class="col-md-6 col-md-offset-3">
    <table id="user" class="table table-bordered table-striped" style="clear: both">
        <tbody>
            <tr>
                <td style="width: 35%; font-weight: bold">Kayıt Id</td>
                <td style="width: 65%;">@Model.IssueId</td>
            </tr>
            <tr>
                <td style="width: 35%; font-weight: bold">Müşteri Adı Soyadı</td>
                <td style="width: 65%;">@(Model.CustomerId == null ? "Müşteri Adı" : MembershipTools.GetNameSurname(Model.CustomerId))</td>
            </tr>
            <tr>
                <td style="width: 35%; font-weight: bold">Operatör Adı Soyadı</td>
                <td style="width: 65%;">@(Model.OperatorId == null ? "Operatör Atanmadı" : MembershipTools.GetNameSurname(Model.OperatorId))</td>
            </tr>
            <tr>
                <td style="width: 35%; font-weight: bold">Teknisyen Adı Soyadı</td>
                <td style="width: 65%;">@(Model.TechnicianId == null ? "Teknisyen Atanmadı" : MembershipTools.GetNameSurname(Model.TechnicianId))</td>
            </tr>
            <tr>
                <td style="width: 35%; font-weight: bold">Açıklama</td>
                <td style="width: 65%;">@Model.Description</td>
            </tr>
            <tr>
                <td style="width: 35%; font-weight: bold">Konum</td>
                <td style="width: 65%;">@Model.Location</td>
            </tr>
            <tr>
                <td style="width: 35%; font-weight: bold">Garanti Durumu</td>
                @if (@Model.WarrantyState)
                {
                    <td style="width: 65%;">Garantisi Var</td>
                }
                else
                {
                    <td style="width: 65%;">Garantisi Yok</td>
                }
            </tr>
            <tr>
                <td style="width: 35%; font-weight: bold">Kayıt Oluşturma Tarihi</td>
                <td style="width: 65%;">@Model.CreatedDate.ToShortDateString()</td>
            </tr>
            <tr>
                <td style="width: 35%; font-weight: bold">Servis Bedeli</td>
                <td style="width: 65%;">@Model.ServiceCharge ₺</td>
            </tr>
            <tr>
                <td style="width: 35%; font-weight: bold">Rapor</td>
                @if (@Model.Report == null)
                {
                    <td style="width: 65%;">Rapor henüz oluşturulmamıştır.</td>
                }
                else
                {
                    <td style="width: 65%;">@Model.Report</td>
                }
            </tr>
            <tr>
                <td style="width: 35%; font-weight: bold">Kayıt Kapanma Tarihi</td>
                @if (@Model.ClosedDate == null)
                {
                    <td style="width: 65%;">Arıza henüz sonuçlanmamıştır.</td>
                }
                else
                {
                    <td style="width: 65%;">@(Model.ClosedDate?.ToShortDateString())</td>
                }
            </tr>
        </tbody>
    </table>
    <div class="form-group">
        @if (Model.IssueState == TeknikServis.Models.Enums.IssueStates.Atandı)
        {
            <button class="btn btn-success btn-xs btniskabul" name="@Model.IssueId">İş Kabul</button>
        }
        @if (Model.IssueState == TeknikServis.Models.Enums.IssueStates.İşlemde)
        {
            <button class="btn btn-success btn-xs btnislemtamam" name="@Model.IssueId">Bitir</button>
        }
    </div>
</div>

@section bottom
    {
    <script src="~/assets/plugins/bootstrap-notify/bootstrap-notify.min.js"></script>
    <script>
        $(function () {
            $(".btniskabul").click(function () {
                var id = this.name;
                $.ajax(
                    {
                        url: "@Url.Action("GetJob","Technician")",
                        method: "post",
                        dataType: "json",
                        data: { id: id }
                    }).done(function (e) {
                        location.reload();
                        $.notify({
                            // options
                            message: e.message,
                            title: 'Mesaj: '
                        },
                            {
                                // settings
                                type: e.success ? "success" : "danger"
                            });
                    });
            });
             $(".btnislemtamam").click(function () {
                var id = this.name;
                $.ajax(
                    {
                        url: "@Url.Action("FinishJob","Technician")",
                        method: "post",
                        dataType: "json",
                        data: { id: id }
                    }).done(function (e) {
                        location.reload();
                        $.notify({
                            // options
                            message: e.message,
                            title: 'Mesaj: '
                        },
                            {
                                // settings
                                type: e.success ? "success" : "danger"
                            });
                    });
            });
        });
    </script>
}

